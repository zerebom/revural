### **ユーザーストーリーマップ: AIレビューパネル (ハッカソンMVP - フォーカスモード)**

**ペルソナ:** 新規機能やプロダクト開発を担当するプロダクトマネージャー (PdM)
**ゴール:** PRDのレビュー依頼から修正完了までのプロセスを、AIの支援によって圧倒的に効率化し、自信を持って開発チームに仕様を渡せる状態を作りたい。

---

#### **バックボーン 1: レビューの依頼**
- **タスク: PRDの入力とレビュー開始**
    - **サブタスク: PRDテキストの入力**
        - `[Must]` ページの主要エリアに、複数行入力可能なテキストエリア (`<textarea>`) が存在する。
        - `[Must]` ユーザーはPRDのテキストを自由にコピー＆ペーストできる。
        - `[Should]` テキストエリアは入力内容に応じて自動で高さが調整される。
    - **サブタスク: レビューパネルの選択**
        - `[Must]` 「Webサービス」「モバイルアプリ」といったプロダクト種別の選択肢がボタンとして表示されている。
        - `[Must]` デフォルトで「Webサービス」が選択状態になっている。
        - `[Should]` 選択した種別に応じて、バックエンドに送信する `panel_type` パラメータが切り替わる。
    - **サブタスク: レビュー開始の実行と状態表示**
        - `[Must]` 「レビュー開始」ボタンが存在する。
        - `[Must]` ボタンをクリックすると、入力されたPRDテキストと選択されたパネル種別がバックエンドAPIにPOSTリクエストとして送信される。
        - `[Must]` リクエスト送信後、ボタンは無効化（`disabled`）され、スピナー付きの「レビュー中...」というテキストに変化する。
        - `[Should]` レビューID (`review_id`) をレスポンスとして受け取り、URLを `/reviews/{review_id}` に遷移させる。新しいページでレビュー結果をポーリングする。

#### **バックボーン 2: 論点の解消 (フォーカスモード)**
- **タスク: 優先度の高い論点から順番に表示・処理**
    - **サブタスク: 最初の論点カードの表示**
        - `[Must]` レビュー詳細ページ (`/reviews/{review_id}`) で、バックエンドAPIからレビュー結果（指摘事項のリスト）を取得する。
        - `[Must]` APIのレスポンスには、各指摘に `priority` (優先度) `agent_name` `agent_avatar` `severity` `comment` `original_text` が含まれる。
        - `[Must]` 最も `priority` が高い指摘事項を、画面中央にカードコンポーネントとして表示する。
    - **サブタスク: 次の論点への遷移**
        - `[Must]` 各カードには「対応済み」「あとで」の2つのステータス変更ボタンがある。
        - `[Must]` いずれかのボタンがクリックされると、現在のカードはフェードアウトし、次に優先度の高い指摘事項のカードがフェードインで表示される。
        - `[Should]` 画面の隅に、残りカード数が「3/10件」のように表示される。
        - `[Must]` 全てのカードを処理すると、「レビュー完了」メッセージと「結果をまとめる」ボタンが表示される。
- **タスク: AIとの対話による論点の深掘り**
    - **サブタスク: チャットUIでの質問**
        - `[Must]` カードコンポーネント内に、テキスト入力欄と「質問する」ボタンで構成されるチャットUIがある。
        - `[Must]` ユーザーが質問を入力して送信すると、指摘事項ID (`issue_id`) と質問テキストをバックエンドの対話APIにPOSTする。
        - `[Must]` APIからのレスポンスを待つ間、ローディングインジケーターが表示される。
    - **サブタスク: チャット履歴の表示**
        - `[Must]` ユーザーの質問とAIの回答は、カード内のチャットUIエリアに時系列で追加されていく。
        - `[Should]` ユーザーの質問は右寄せ、AIの回答は左寄せで表示されるなど、視覚的に区別される。
- **タスク: AIによる修正案の取得**
    - **サブタスク: 修正案の提案リクエスト**
        - `[Should]` チャットUIの近くに「修正案を提案して」ボタンがある。
        - `[Should]` ボタンをクリックすると、指摘事項ID (`issue_id`) をバックエンドの修正提案APIにPOSTする。
    - **サブタスク: 修正案の表示**
        - `[Should]` APIから返ってきた修正案のテキストを、カード内の指定エリアに表示する。
        - `[Nice to Have]` 修正案が差分形式（diff）で表示され、どの部分が変更されたか分かりやすい。
    - **サブタスク: 修正案の適用**
        - `[Should]` 提案された修正案の横に「適用する」ボタンを表示する。
        - `[Should]` ユーザーが「適用する」ボタンをクリックすると、バックエンドで管理されているPRD原文の該当箇所が、提案内容で自動的に更新される。
        - `[Nice to Have]` 修正が適用された箇所は、PRD原文ビュー（もしあれば）で一時的にハイライト表示される。

#### **バックボーン 3: 結果の共有**
- **タスク: レビューサマリーの生成と共有**
    - **サブタスク: サマリーページの生成**
        - `[Must]` レビュー完了画面の「結果をまとめる」ボタンをクリックすると、サマリーページ (`/reviews/{review_id}/summary`) に遷移する。
        - `[Must]` サマリーページは、①元のPRD全文、②全指摘事項とAIとの対話履歴の一覧、③各指摘の対応ステータス（対応済み/あとで）を表示する。
    - **サブタスク: 共有用URLの発行**
        - `[Must]` サマリーページに「共有URLをコピー」ボタンがある。
        - `[Must]` ボタンをクリックすると、クリップボードに閲覧専用ページのURLがコピーされる。
        - `[Should]` URLにはハッシュやトークンが含まれ、推測されにくいものにする。
    - **サブタスク: 閲覧専用ページの提供**
        - `[Must]` 共有URLにアクセスすると、ログイン不要でサマリーページの内容を閲覧できる。
        - `[Nice to Have]` ページの内容を整形されたMarkdownテキストとしてダウンロードできる「エクスポート」機能がある。

# PRD: AIレビューパネル (ハッカソンMVP)

## Overview

プロダクトマネージャー(PdM)が作成したPRD(製品要求仕様書)を、複数の専門的視点を持つAIエージェントがレビューするSaaSツール。特に、最も重要な論点から一つずつ集中して解消していく「フォーカスモード」体験をMVPの中核とし、PdMが仕様の抜け漏れやリスクを開発着手前に効率的に特定することを支援する。

---

## Outcomes

- **理想状態:** PdMが、開発チームへ仕様を渡す前にあらゆる抜け漏れやリスクを潰し、自信を持って開発をスタートできる状態。
- **提供価値:**
  - [ ] PRDレビューと修正にかかる時間を劇的に短縮し、PdMがより戦略的な業務に集中できる。
  - [ ] 開発着手前の仕様の質を向上させることで、開発中の「手戻り」を削減し、チーム全体の生産性を最大化する。
  - [ ] AIとの壁打ちを通じて、PdM自身の考慮漏れや思考のクセを客観的に把握し、スキルアップに繋がる。

### AIの信頼性と透明性

- `[Must]` PdMがAIの提案を信頼し、納得感を持って利用できるよう、AIの指摘や提案に対するフィードバック機能（例：👍/👎ボタン）を提供する。
- `[Must]` UI上で各AIエージェントの専門領域（例：「この指摘はUXデザイナーAIによるものです」）を明示する。
- `[Should]` AIの能力的な限界や、レビューが100%の網羅性を保証するものではないことを示す注意書きを表示する。

---

## Issues

- **課題:**
  - [ ] PdMは、PRDのレビューを依頼する関係者のスケジュール調整や、フィードバックの収集・反映に多大な時間を費-している。
  - [ ] 人間のレビューでは、専門外の領域や細かいエッジケースの見落としが頻繁に発生し、それが後工程での手戻りの原因となる。
  - [ ] 仕様の不備が原因で発生する手戻りは、エンジニアのモチベーションを低下させ、プロダクトの市場投入の遅れ（機会損失）にもつながる。PdMは「自分のPRDは本当にこれで完璧なのか」という孤独な不安を常に抱えている。

---

## Goals

- PdMのPRDレビューと修正にかかる時間を、手動でのレビュープロセスと比較して50%削減する。
- ユーザーテストを通じて、10人中8人以上のPdMが「手戻りを減らせそうだと感じた」「自信を持って仕様をチームに共有できるようになった」と回答する。

---

## Targets

### Segments

- **最大の利用セグメント:**
  - スタートアップから中堅企業（従業員50〜300人規模）に所属し、アジャイルなプロダクト開発プロセスを採用しているチーム。
- **特に利用が見込めるペルソナ:**
  - **B2B SaaS企業のプロダクトマネージャー (PdM)**
    - **背景:** 開発リソースが限られているため、手戻りは事業インパクトに直結する。
    - **課題:** エンジニア、デザイナー、QAといった関係者は他の業務も兼任しており、PRDレビューに十分な時間を確保することが難しい。そのため、レビューが形式的になったり、重要な観点が見過ごされたりするリスクを常に感じている。
    - **JTBD:** 「開発チームに仕様を渡す前に、あらゆる抜け漏れやリスクを潰し、自信を持って開発をスタートさせたい」

### Clients

- (ハッカソン段階では、社内のPdMや知人のPdM数名を初期テスターとして想定)

---

## User Senarios / Requirements

### バックボーン 1: レビューの依頼

- **ユーザー:** B2B SaaS企業（SFAツール提供）で働くプロダクトマネージャー
- **課題背景:** 次のスプリントで開発予定の「ダッシュボードのカスタマイズ機能」に関するPRDドラフトを作成した。開発チームに仕様を渡す前に、仕様の曖昧さ、技術的リスク、エッジケースの考慮漏れがないかを確認したい。しかし、エンジニアリングマネージャーは採用業務で多忙を極め、UXデザイナーも別プロジェクトで手一杯な状況。このままではレビューが不十分なまま開発が進み、後工程で致命的な手戻りが発生するリスクを強く感じている。
- **ゴール:**
  1. PRDドラフトをインプットしてから30分以内に、自分一人では気づけなかったであろう複数の重要な論点（技術的リスク、UX上の懸念等）の存在を認識し、なぜそれが問題なのかを腹落ちして理解できている。
  2. 特定した論点について、AIとの対話を通じて深掘りすることで、「何をすべきか」が明確になっている。技術的懸念やUX上の問題点に対して、PRDに追記・修正すべき具体的な要件や制約事項が言語化され、自信を持って仕様を改善できる状態になっている。
  3. AIとの共創を経て改善されたPRDのレビューサマリーを手に、開発チームとのレビュー会議に臨める。そこでは、単に仕様を説明するだけでなく、検討された主要な論点やトレードオフ、そして「なぜこの仕様に決定したのか」という背景や意思決定プロセスまでを、自信を持って説明できる状態になっている。

#### 1.1.1 サブタスク: PRDテキストの入力

- `[Must]` ページの主要エリアに、複数行入力可能なテキストエリア (`<textarea>`) が存在する。
- `[Must]` ユーザーはPRDのテキストを自由にコピー＆ペーストできる。
- `[Should]` テキストエリアは入力内容に応じて自動で高さが調整される。

#### 1.1.2 サブタスク: レビューパネルの選択

- `[Must]` 「Webサービス」「モバイルアプリ」といったプロダクト種別の選択肢がボタンとして表示されている。
- `[Must]` デフォルトで「Webサービス」が選択状態になっている。
- `[Should]` 選択した種別に応じて、バックエンドに送信する `panel_type` パラメータが切り替わる。

#### 1.1.3 サブタスク: レビュー開始の実行と状態表示

- `[Must]` 「レビュー開始」ボタンが存在する。
- `[Must]` ボタンをクリックすると、入力されたPRDテキストと選択されたパネル種別がバックエンドAPIにPOSTリクエストとして送信される。
- `[Must]` リクエスト送信後、ボタンは無効化（`disabled`）され、スピナー付きの「レビュー中...」というテキストに変化する。
- `[Should]` レビューID (`review_id`) をレスポンスとして受け取り、URLを `/reviews/{review_id}` に遷移させる。新しいページでレビュー結果をポーリングする。
- `[Must]` バックエンドAPIとの通信はすべてHTTPSで行われる。

### バックボーン 2: 論点の解消 (フォーカスモード)

#### 2.0 タスク: オンボーディング

- `[Should]` 最初の論点カードを表示する際に、「フォーカスモード」の簡単な説明（例：「最も重要な論点から一つずつ集中して解消していきましょう」）をツールチップやモーダルで表示する。

#### 2.1 タスク: 優先度の高い論点から順番に表示・処理

##### 2.1.1 サブタスク: 最初の論点カードの表示

- `[Must]` レビュー詳細ページ (`/reviews/{review_id}`) で、バックエンドAPIからレビュー結果（指摘事項のリスト）を取得する。
- `[Must]` APIのレスポンスには、各指摘に `priority` (優先度), `agent_name`, `agent_avatar`, `severity`, `comment`, `original_text` が含まれる。
- `[Must]` 最も `priority` が高い指摘事項を、画面中央にカードコンポーネントとして表示する。
- `[Should]` カード内の情報は、PdMが瞬時に理解できるよう視覚的な階層（例：指摘コメントを最も目立たせる）を考慮してレイアウトする。
- `[Nice to Have]` `original_text`（指摘箇所の原文）が、カード内でハイライト表示される。

##### 2.1.2 サブタスク: 次の論点への遷移

- `[Must]` 各カードには「対応済み」「あとで」の2つのステータス変更ボタンがある。
- `[Must]` いずれかのボタンがクリックされると、現在のカードはフェードアウトし、次に優先度の高い指摘事項のカードがフェードインで表示される。
- `[Should]` 画面の隅に、残りカード数が「3/10件」のように表示される。
- `[Must]` 全てのカードを処理すると、「レビュー完了」メッセージと「結果をまとめる」ボタンが表示される。

#### 2.2 タスク: AIとの対話による論点の深掘り

##### 2.2.1 サブタスク: チャットUIでの質問

- `[Must]` カードコンポーネント内に、テキスト入力欄と「質問する」ボタンで構成されるチャットUIがある。
- `[Must]` ユーザーが質問を入力して送信すると、指摘事項ID (`issue_id`) と質問テキストをバックエンドの対話APIにPOSTする。
- `[Must]` APIからのレスポンスを待つ間、ローディングインジケーターが表示される。

##### 2.2.2 サブタスク: チャット履歴の表示

- `[Must]` ユーザーの質問とAIの回答は、カード内のチャットUIエリアに時系列で追加されていく。
- `[Should]` ユーザーの質問は右寄せ、AIの回答は左寄せで表示されるなど、視覚的に区別される。

#### 2.3 タスク: AIによる修正案の取得

##### 2.3.1 サブタスク: 修正案の提案リクエスト

- `[Should]` チャットUIの近くに「修正案を提案して」ボタンがある。
- `[Should]` ボタンをクリックすると、指摘事項ID (`issue_id`) をバックエンドの修正提案APIにPOSTする。

##### 2.3.2 サブタスク: 修正案の表示

- `[Should]` APIから返ってきた修正案のテキストを、カード内の指定エリアに表示する。
- `[Must]` ユーザーが変更内容を正確に把握できるよう、修正案は差分形式（diff）で表示する。
- `[Should]` 修正案をクリップボードにコピーするボタンを提供する。

##### 2.3.3 サブタスク: 修正案の適用 (MVPスコープ外)

- `[Post-MVP]` ハッカソンMVPでは、PdMが表示された修正案を手動でコピー＆ペーストしてPRDに反映する運用とする。「適用」ボタンによる自動反映機能は次フェーズ以降で検討する。

### バックボーン 3: 結果の共有

#### 3.1 タスク: レビューサマリーの生成と共有

##### 3.1.1 サブタスク: サマリーページの生成

- `[Must]` レビュー完了画面の「結果をまとめる」ボタンをクリックすると、サマリーページ (`/reviews/{review_id}/summary`) に遷移する。
- `[Must]` サマリーページは、①元のPRD全文、②全指摘事項とAIとの対話履歴の一覧、③各指摘の対応ステータス（対応済み/あとで）を表示する。
- `[Should]` サマリーの内容を整形されたMarkdownテキストとしてダウンロードできる「エクスポート」機能、またはクリップボードにコピーする機能を提供する。
- `[Should]` 指摘事項の一覧は、デフォルトでアコーディオン形式で折りたたまれており、ユーザーが任意で詳細を展開できるようにする。

##### 3.1.2 サブタスク: 共有用URLの発行 (MVPスコープ外)

- `[Post-MVP]` ログイン不要で結果を共有できるURL発行機能は、セキュリティやインフラの考慮が必要なため、次フェーズ以降で検討する。

##### 3.1.3 サブタスク: 閲覧専用ページの提供 (MVPスコープ外)

- `[Post-MVP]` 上記の共有URL機能に紐づく機能として、次フェーズ以降で検討する。

---

## Sitemap

- `/projects/new` **(レビュー依頼ページ)**
  - Component: PRD入力テキストエリア
  - Component: レビューパネル選択ボタン
  - Component: レビュー開始ボタン
- `/reviews/:id` **(レビュー詳細ページ - フォーカスモード)**
  - **State: 論点カード表示**
    - Component: 指摘内容 (指摘者、指摘箇所、重要度)
    - Component: AIとの対話UI (チャット形式)
    - Component: 修正案の表示エリア
    - Component: アクションボタン (対応済み / あとで)
- `/reviews/:id/summary` **(共有用サマリーページ)**
  - Component: 元のPRDテキスト
  - Component: 全ての指摘事項と対話履歴の一覧
  - Component: Markdownエクスポート/コピーボタン

---

## Design

- (Figmaにてプロトタイプを作成予定。URLを後ほど追記)

---

## Security & Privacy

PRDは企業の機密情報を含む可能性があるため、MVP段階であっても以下の点に配慮する。

- **データ暗号化:**
  - `[Must]` ユーザーが入力したPRDデータは、データベース保存時に暗号化する。
  - `[Must]` フロントエンドとバックエンドAPI間の通信は、すべてTLS/SSL (HTTPS) で暗号化する。
- **データ保持ポリシー:**
  - `[Should]` ユーザーが任意でレビューデータを削除できる機能を提供する。
  - `[Nice to Have]` 作成から一定期間（例：30日）が経過したレビューデータは自動的に削除される。
- **LLMプロバイダーとの連携:**
  - `[Must]` 利用するLLMプロバイダーのAPIが、送信されたデータをモデルの学習に利用しない設定であることを確認し、明記する。

---

## AI Architecture

### 1. AIエージェントの役割定義

#### 1.1 エージェントの種類

- **バックエンドエンジニアAI:** スケーラビリティ、パフォーマンス、セキュリティ、DB設計の観点からレビューする。
- **UXデザイナーAI:** ユーザビリティ、情報設計、UIの一貫性、エッジケースでのユーザー体験の観点からレビューする。
- **QAテスターAI:** 仕様の曖昧さ、テスト容易性、異常系の考慮漏れ、境界値の観点からレビューする。
- **プロダクトマネージャーAI:** 目的との整合性、KPIとの関連性、ユーザーへの提供価値の観点からレビューする。

#### 1.2 パネル構成

- `panel_type: "Webサービス"`が選択された場合、上記4体のエージェント全員でレビューチームを構成する。

### 2. レビュー実行プロセス（オーケストレーション）

1. **ディスパッチ:** ユーザーからPRDを受け取ると、**レビューオーケストレーター**は定義されたパネル構成に基づき、各AIエージェントにPRDのレビューを並行して依頼する。
2. **結果の集約:** オーケストレーターは、各エージェントから指摘事項のリスト（`comment`, `severity`, `original_text`などを含む）を収集する。
3. **統合と優先順位付け:**
    - オーケストレーターは、意味的に類似する指摘（例：パフォーマンスに関する指摘）を特定し、一つの論点としてグルーピングする。
    - オーケストレーターは、各指摘の`severity`や、プロダクトへの影響度、およびそれらの指摘がプロダクトのコア機能にどれだけ関連しているかを総合的に評価し、ユーザーに提示すべき最終的な`priority`を決定する。例えば、セキュリティリスクや主要なユーザーストーリーの破綻に繋がる指摘は、軽微なUIの不整合に関する指摘よりも高い優先度を持つ。
    - このプロセスを経て、`AI Agent I/O`で定義された最終的なJSONデータ構造を生成する。

### 3. AI Agent I/O (Input/Output)

#### 3.1 初期レビュー実行時

**Input:**

- `prd_text` (string): ユーザーが入力したPRDの全文テキスト。
- `panel_type` (string): ユーザーが選択したプロダクト種別（例: "Webサービス"）。

**Output (Data Structure):**

- 指摘事項の配列 (Array of Objects)。各指摘は以下のJSON形式で構成される。

```json
[
  {
    "issue_id": "ISSUE-001",
    "priority": 1,
    "agent_name": "エンジニアAI",
    "agent_avatar": "icon-engineer.png",
    "severity": "High",
    "comment": "カスタマイズ項目の保存ロジックにN+1問題が発生するリスクがあります。大量の項目を一度に保存すると、パフォーマンスが著しく低下する可能性があります。",
    "original_text": "ユーザーはダッシュボードの表示項目を自由にカスタマイズし、その設定を保存できる。"
  },
  {
    "issue_id": "ISSUE-002",
    "priority": 2,
    "agent_name": "UXデザイナーAI",
    "agent_avatar": "icon-ux.png",
    "severity": "Mid",
    "comment": "カスタマイズ項目が大量になった場合のUI表示が考慮されていません。リストが長大になると、ユーザーが目的の項目を見つけるのが困難になります。",
    "original_text": "ユーザーはダッシュボードの表示項目を自由にカスタマイズできる。"
  }
]
```

#### 3.2 対話による深掘り時

**Input:**

- `issue_id` (string): ユーザーがどの論点について質問しているかを特定するID。
- `question_text` (string): ユーザーが入力した質問のテキスト。

**内部処理:**

- `issue_id`に基づき、元の指摘内容と指摘者（例: "エンジニアAI"）を特定する。
- それらの情報と`question_text`をセットで、担当のAIエージェントに渡して回答を生成させる。

**Output (Data Structure):**

- 回答テキストを含むJSONオブジェクト。

```json
{
  "response_text": "ユーザーが50個以上の項目を一度に保存した場合、DBへのリクエストが大量に発生し、サーバーの応答時間が5秒以上かかる可能性があります。これを防ぐためには、バルクインサートのような効率的な保存方法を検討するか、一度に保存できる項目数に上限を設ける必要があります。"
}
```

#### 3.3 修正案の提案時

**Input:**

- `issue_id` (string): どの論点に対する修正案を求めているかを特定するID。

**内部処理:**

- `issue_id`に基づき、元の指摘内容と、もしあればその論点に関する対話の履歴もインプットとして取得する。
- 担当のAIエージェントに「この問題を解決するための具体的なPRD追記文案を生成せよ」という指示と共に情報を渡す。

**Output (Data Structure):**

- 具体的な修正案のテキストを含むJSONオブジェクト。修正対象の原文箇所を特定するための `target_text` も返す。

```json
{
  "suggested_text": "PRDの要件に以下を追記することを推奨します。「ユーザー体験を損なわないため、一度に保存できる項目は最大100個までとする。」",
  "target_text": "ユーザーはダッシュボードの表示項目を自由にカスタマイズし、その設定を保存できる。"
}
```

#### 3.4 修正案の適用時 (Post-MVP)

**Input:**

- `issue_id` (string): どの論点の修正案を適用するかを特定するID。

**内部処理 (MVPスコープ外):**

- `issue_id` に紐づく `suggested_text` と `target_text` を取得する。
- バックエンドで管理されているPRD全文の中から `target_text` を探し、`suggested_text` で置換または追記する。
- 更新されたPRD全文を、元のPRDとは別のバージョンとして保存する。

**Output (Data Structure):**

- 成功したかどうかを示すステータス。

```json
{
  "status": "success"
}
```

### 4. マルチエージェント連携フロー

```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant API
    participant Review Orchestrator
    participant Specialist AIs

    User->>Frontend: PRDを入力しレビュー開始
    Frontend->>API: POST /reviews (prd_text, panel_type)
    API->>Review Orchestrator: レビュー実行を依頼

    note right of Review Orchestrator: 1. panel_typeに基づき<br/>専門AIチームを編成

    Review Orchestrator->>Specialist AIs: PRDを渡し並行レビューを指示
    note right of Specialist AIs: 各AIは自身の専門性に<br/>基づきPRDをレビュー

    Specialist AIs->>Review Orchestrator: 指摘事項リスト(Raw)を返却

    note right of Review Orchestrator: 2. 全AIからの指摘を集約<br>3. 指摘の統合・重複排除<br>4. 最終的な優先順位を決定

    Review Orchestrator->>API: 整形済みの「論点リスト」を返す
    API->>Frontend: review_id と共に成功応答

    loop フロントエンドから結果取得
        Frontend->>API: GET /reviews/{review_id}
        API->>Frontend: 論点リスト(JSON)を返す
    end

    Frontend->>User: 最も優先度の高い論点カードを表示
```

### 5. PRDテキストの管理

- **バージョニング:**
  - `[Must]` ユーザーがレビューを開始した時点のPRDテキスト (`prd_text`) は、そのレビューセッション (`review_id`) に紐づく不変のスナップショットとしてデータベースに保存する。
  - `[Post-MVP]` AIの修正案を自動適用する機能が実装された場合、更新後のPRDは新しいバージョンとして保存され、変更履歴を追跡できるようにする。
- **書式保持:**
  - `[Should]` ユーザーが入力したMarkdownの書式（見出し、リスト、太字など）は、レビュープロセス全体を通じて維持される。AIが生成する指摘事項の `original_text` も、元の書式を保持した状態で表示する。

### 6. パフォーマンスとエラーハンドリング

- **パフォーマンス目標:**
  - `[Must]` ユーザーが「レビュー開始」をクリックしてから、最初の論点カードが表示されるまでの時間は、平均30分以内を目指す。
- **エラーハンドリング:**
  - `[Must]` レビュー実行中にバックエンドでエラー（LLMのAPIエラー、タイムアウト等）が発生した場合、フロントエンドにその旨を明確に表示し、ユーザーに再実行を促す。
  - `[Should]` 内部的なエラー（例：LLMからの予期せぬ形式のレスポンス）が発生した場合、システムはリトライ処理を試みる。
  - `[Must]` すべてのAPIエンドポイントで、想定される入力値のバリデーションを厳格に行う。

### 7. データモデル

レビュー結果や対話履歴を永続化するため、以下のデータモデルを設計する。

- **`reviews` テーブル:**
  - `review_id` (PK)
  - `original_prd_text` (暗号化)
  - `panel_type`
  - `created_at`
- **`issues` テーブル:**
  - `issue_id` (PK)
  - `review_id` (FK)
  - `priority`
  - `agent_name`, `agent_avatar`
  - `severity`, `comment`, `original_text`
  - `status` ('pending', 'done', 'later') - ユーザーの対応状況
- **`dialogues` テーブル:**
  - `dialogue_id` (PK)
  - `issue_id` (FK)
  - `speaker` ('user', 'ai')
  - `text`
  - `created_at`

### 8. 非同期処理とフロントエンドへの結果通知

- **MVPでの実装:**
  - `[Must]` フロントエンドは、レビュー開始後に定期的に結果取得APIをポーリングし、レビューの完了を検知する。
- **将来的な改善 (Post-MVP):**
  - `[Post-MVP]` ポーリングによるサーバー負荷を軽減し、よりリアルタイムな体験を提供するため、将来的にはロングポーリング、WebSocket、またはServer-Sent Events (SSE) への移行を検討する。

---

## Infrastructure & Cost

- **コスト管理:**
  - `[Should]` LLMのAPI利用料をトラッキングし、想定以上のコストが発生していないか継続的に監視する。コストアラートを設定する。
  - `[Nice to Have]` 繰り返し同じ内容がレビューされる場合に備え、キャッシュ戦略を検討する。
- **モニタリング:**
  - `[Should]` APIの応答時間、エラーレート、DBの負荷など、システムの健全性を測る基本的なメトリクスを監視する体制を構築する。

---

## KPIs

### 機能活用を測る指標 (先行指標)

- **レビュー実行回数:** 1週間あたりに実行されるレビューの総数。
- **論点処理率:** 1レビューあたりで「対応済み」とされた論点の割合。
- **リピート率:** 初回利用ユーザーが1週間以内に2回目のレビューを実行する割合。

### 価値への貢献を測る指標 (遅行指標)

- **定性フィードバック:**
  - 「仕様の質が上がった」「レビュー会議の時間が短縮された」といった、利用ユーザーおよびその開発チームからの声。

---

## Pricing & GTMs

### Pricing (有料 or 無料)

- **無料** (ハッカソンMVP段階)

### GTMs (機能をどう理解してもらい、利用促進するか)

- **知ってもらう:**
  - ハッカソンでのデモ発表。
  - PdMが集まるオンラインコミュニティやSNSでの発信。
- **利用促進:**
  - 誰でもすぐに試せるように、ユーザー登録不要でPRDを貼り付ければ即座にレビューが開始されるシンプルなUIを提供する。

---

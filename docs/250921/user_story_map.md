### **ユーザーストーリーマップ: AIレビューチーム編成機能**

**ペルソナ:** 新規機能やプロダクト開発を担当するプロダクトマネージャー (PdM)
**ゴール:** PRDのレビューを依頼する際に、まるで専門家チームを編成するように、レビューしてほしいAIエージェントをその専門性や個性を見ながら自分で選びたい。それによって、得られるフィードバックへの納得感を高め、レビュープロセス自体を楽しみたい。

# As-Is / To-Be: AIレビューチーム編成機能

## 1. As-Is (現状)

### UI/UXフロー
1.  **単一の入力フォーム:** ユーザーはトップページで、製品要求仕様書（PRD）を貼り付けるための大きなテキストエリアのみを操作します。
2.  **固定化されたレビュープロセス:** 「専門家レビューを開始」ボタンを押すと、バックグラウンドで予め定義された固定の専門家チーム（Webサービスパネルなど）によるレビューが実行されます。
3.  **誰からのレビューか不明確:** レビュー結果画面では、どの指摘がどの専門家（AIエージェント）からのものかが明示されません。

### 技術的な実装
- **フロントエンド:** `PrdInputForm.tsx` は、`prdText` のみを取得し、`api.startReview(prdText)` の形でAPIを呼び出しています。エージェントやパネルを選択するUIは存在しません。
- **バックエンドAPI:** `/reviews` エンドポイントは `panel_type` というパラメータを受け取る準備がありますが、現状のフロントエンドからは利用されておらず、常にデフォルトの挙動をします。

---

## 2. To-Be (目指す姿)

### UI/UXフロー
1.  **チーム編成UIの追加:** PRDを貼り付けるテキストエリアの下に、「レビューチームを選択」セクションが新設されます。
2.  **専門家の可視化と選択:** ユーザーは、各AIエージェントの顔（アバター）、名前、肩書き、専門性が書かれたプロフィールカードを見て、レビューを依頼したいメンバーを直感的に選択できます。これにより、「人を選んでチームを組む」という体験を提供します。
3.  **選択したチームへの依頼:** 「選択したチームにレビューを依頼」ボタンを押すと、自分が選んだエージェント構成でレビューが実行されます。
4.  **顔の見えるレビュー結果:** レビュー結果画面では、全ての指摘事項に「誰が（どのエージェントが）指摘したか」がアバター付きで明示されます。これにより、指摘の背景にある専門性をユーザーが理解しやすくなり、納得感が高まります。

### 技術的な実装
- **フロントエンド:**
    - `PrdInputForm.tsx` に、状態（`useState`）で選択されたエージェントIDのリストを管理するロジックを追加します。
    - 選択されたIDリストを `panel_type` パラメータ（例: `"backend_engineer,ux_designer"` のようなカンマ区切りの文字列）として `api.startReview` に渡します。
    - エージェントのプロフィール情報を保持する `frontend/lib/agents.ts` のようなファイルを作成します。
- **バックエンドAPI:** `/reviews` エンドポイントで `panel_type` パラメータを受け取り、指定されたエージェント構成でレビュープロセスを動的に実行するようにします。パラメータが`null`の場合は従来通りのデフォルト構成で動作します。


---

#### **バックボーン 1: レビューの準備**
- **タスク: PRDの入力**
    - **サブタスク: PRDテキストのペースト**
        - `[Must]` ページの主要エリアに、複数行入力可能なテキストエリアが存在する。
        - `[Must]` ユーザーはPRDのテキストを自由にコピー＆ペーストできる。
        - `[Should]` テキストエリアは入力内容に応じて自動で高さが調整される。

- **タスク: レビューチームの編成**
    - **サブタスク: エージェントのプロフィール閲覧**
        - `[Must]` PRD入力フォームの下に、「レビューチームを選択」セクションが表示される。
        - `[Must]` 4人のAIエージェント（バックエンド、UX、QA、PdM）のプロフィールカードが一覧で表示される。
        - `[Must]` 各カードには、エージェントの名前、肩書き、専門性を示す一言紹介文が表示されている。
        - `[Should]` 各カードに、専門分野を示すタグ（例: #セキュリティ, #ユーザビリティ）が表示されている。
        - `[Nice to Have]` 各カードに、人間味を感じさせるユニークなアバターアイコンが表示されている。
    - **サブタスク: エージェントの選択**
        - `[Must]` ユーザーはプロフィールカードをクリックすることで、レビューを依頼するエージェントを複数選択できる。
        - `[Must]` 選択されたカードは、背景色や枠線のスタイルが変化し、選択状態であることが視覚的に明確にわかる。
        - `[Must]` 再度クリックすると、選択が解除される。
        - `[Should]` デフォルトでは、すべてのエージェントが選択された状態になっている。
        - `[Nice to Have]` エージェントを選択すると、「レビューを依頼する」ボタンのテキストが「選択した4人のチームにレビューを依頼」のように動的に変化する。

#### **バックボーン 2: レビューの実行と結果確認**
- **タスク: レビューの開始**
    - **サブタスク: 依頼の実行と状態表示**
        - `[Must]` 「レビューを依頼する」ボタンが存在する。
        - `[Must]` ボタンをクリックすると、入力されたPRDテキストと、選択されたエージェントのIDリストがバックエンドAPIに送信される。
        - `[Must]` リクエスト送信後、ボタンは無効化され、スピナー付きの「レビュー中...」というテキストに変化する。
        - `[Should]` レビューID (`review_id`) をレスポンスとして受け取り、URLを `/reviews/{review_id}` に遷移させる。

- **タスク: レビュー結果の確認（フォーカスモード）**
    - **サブタスク: 論点カードの表示**
        - `[Must]` レビュー詳細ページで、バックエンドAPIからレビュー結果（指摘事項のリスト）を取得する。
        - `[Must]` APIのレスポンスには、各指摘に `agent_name` `agent_avatar` が含まれており、**誰からの指摘か**が明確にわかる。
        - `[Must]` 最も優先度が高い指摘事項を、画面中央にカードコンポーネントとして表示する。
        - `[Should]` 指摘者（エージェント）のアバターや名前が、論点カードの目立つ位置に表示される。

- **タスク: 対話とサマリー（既存機能の維持）**
    - **サブタスク: AIとの対話**
        - `[Must]` ユーザーは、特定の論点カードについて、指摘したエージェントと対話ができる。
    - **サブタ-スク: サマリーページの確認**
        - `[Must]` サマリーページで、全指摘事項の一覧を表示する際も、それぞれの指摘がどのエージェントからのものかが明確にわかる。

# コード品質の自動改善

`make check-all`が成功するまで、自動的にコードを修正してコード品質を保証します。

このコマンドは、CLAUDE.mdの「コード品質を保証する」セクションに従い、以下の順序で品質チェックと修正を実行します：

1. **コードフォーマット** (`make format`) - Ruffによる自動フォーマット
2. **リントチェック** (`make lint`) - Ruffによるリントチェックと自動修正
3. **型チェック** (`make typecheck`) - mypyによる厳格な型チェック
4. **テスト実行** (`make test`) - 全テストの実行

## 実行手順

1. まず `make check-all` を実行して現在の状態を確認
2. エラーが発生した場合、以下の優先順位で修正を試みる：
   - フォーマットエラー: `make format` で自動修正
   - リントエラー: `make lint` で自動修正可能なものは修正、手動修正が必要なものは詳細を報告
   - 型エラー: エラーメッセージを分析し、適切な型ヒントや型キャストを追加
   - テスト失敗: 失敗原因を特定し、コードまたはテストを修正

3. 各修正後に `make check-all` を再実行し、すべてのチェックが通るまで繰り返す

## 重要な注意事項

- **CLAUDE.mdの規約に従う**: 型ヒント、エラーメッセージ、コーディングスタイルはCLAUDE.mdの規約に準拠
- **既存の動作を保持**: テストが失敗した場合、まず実装が仕様通りかを確認し、必要に応じてテストも修正
- **段階的な修正**: 一度にすべてを修正せず、エラーの種類ごとに段階的に対処
- **進捗の報告**: 各ステップでの修正内容と結果を明確に報告

## エラー対処の具体例

### 型エラーの例
```python
# エラー: Incompatible return value type (got "None", expected "str")
def get_name() -> str:
    return None  # 修正前

# 修正後
def get_name() -> str | None:
    return None
```

### リントエラーの例
```python
# エラー: F401 'os' imported but unused
import os  # 修正: 未使用のインポートを削除

# エラー: E501 line too long (120 > 100 characters)
# 修正: 長い行を適切に改行
```

このコマンドを実行することで、プロジェクトのコード品質を一貫して高いレベルに保つことができます。

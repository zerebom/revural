# /improve - エビデンスベースの改善

**目的**: 測定可能な証拠に基づいたコード改善の提案と実装

## 概要

`/improve`コマンドは、コード品質、パフォーマンス、アーキテクチャの改善を、具体的な証拠とメトリクスに基づいて実行します。

## 使用方法

```bash
/improve [オプション] [対象]
```

## オプション

### --quality
コード品質の改善：
- 可読性の向上（命名、構造）
- 保守性の改善（モジュール化、依存関係）
- DRY原則の適用
- 複雑性の削減
- エラーハンドリングの改善

### --perf
パフォーマンスの最適化：
- アルゴリズムの効率化
- メモリ使用量の削減
- I/O操作の最適化
- キャッシング戦略の実装
- 並列処理の活用

### --arch
アーキテクチャの改善：
- 設計パターンの適用
- 依存性注入の実装
- レイヤー分離の強化
- モジュール境界の明確化
- スケーラビリティの向上

### 実行モードフラグ
- `--refactor`: 動作を変えずに内部構造を改善
- `--iterate`: 指定された閾値まで繰り返し改善
- `--safe`: 保守的な改善のみ実行
- `--metrics`: 改善前後のメトリクスを表示

### 品質閾値
- `--threshold low`: 基本的な改善
- `--threshold medium`: 標準的な改善（デフォルト）
- `--threshold high`: 高品質を目指す改善
- `--threshold perfect`: 可能な限り最高品質

## 実行例

### 基本的な使用
```bash
# コード品質の改善
/improve --quality src/

# パフォーマンスの反復改善
/improve --perf --iterate --threshold high

# 安全なリファクタリング
/improve --arch --refactor --safe
```

### 高度な使用
```bash
# メトリクス付き品質改善
/improve --quality --metrics --threshold perfect

# 複合的な改善
/improve --quality --perf --arch --iterate
```

## 改善プロセス

1. **現状分析**
   - 現在のメトリクスを測定
   - 改善機会を特定
   - 優先順位を設定

2. **計画立案**
   - 安全な改善パスを設計
   - 既存機能の保持を確認
   - 段階的な変更計画

3. **実装**
   - 小さな原子的変更
   - 継続的なテスト実行
   - パフォーマンス監視

4. **検証**
   - 動作の保持を確認
   - メトリクスの改善を測定
   - 回帰テストの実行

## 出力形式

```yaml
改善サマリー:
  対象: [改善対象のパス]
  改善項目数: [実施した改善の数]

改善前メトリクス:
  コード品質スコア: [0-100]
  サイクロマティック複雑性: [平均値]
  パフォーマンススコア: [0-100]

実施した改善:
  - タイプ: [改善の種類]
    場所: [ファイル:行番号]
    変更内容: [具体的な変更]
    根拠: [測定データに基づく理由]
    効果: [期待される改善効果]

改善後メトリクス:
  コード品質スコア: [0-100] (改善率: +X%)
  サイクロマティック複雑性: [平均値] (改善率: -Y%)
  パフォーマンススコア: [0-100] (改善率: +Z%)
```

## 既存ツールとの連携

改善プロセスは以下のツールを活用：

- `make format`: コードフォーマットの統一
- `make lint`: リント違反の自動修正
- `make typecheck`: 型の一貫性確認
- `make test`: 改善後の動作確認
- `make benchmark`: パフォーマンス改善の測定

## 改善パターン

### コード品質
- 長い関数の分割
- ネストの深さ削減
- 明確な変数名への変更
- 型ヒントの追加
- エラーメッセージの改善

### パフォーマンス
- リスト内包表記の活用
- 不要なループの削除
- キャッシュの実装
- 遅延評価の導入
- バッチ処理の実装

### アーキテクチャ
- ファサードパターンの適用
- 依存性の逆転
- インターフェースの抽出
- モジュールの再編成
- 横断的関心事の分離

## 注意事項

- `--iterate`モードは処理時間が長くなる可能性があります
- 大規模な変更前は必ずバックアップまたはgitのコミットを作成してください
- パフォーマンス改善は必ずベンチマークで検証してください
- テストカバレッジが低い場合は、先にテストを追加することを推奨します
